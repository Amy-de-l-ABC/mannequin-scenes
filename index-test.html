<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>1:12PM Abigail Scene â€“ Save/Load Camera</title>
  <link rel="stylesheet" href="style.css" />
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.167.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.167.0/examples/jsm/",
      "mannequin": "https://cdn.jsdelivr.net/npm/mannequin-js@latest/src/mannequin.js"
    }
  }
  </script>
  <style>
    html, body { margin: 0; height: 100%; overflow: hidden; }
    #controls {
      position: fixed;
      top: 10px; left: 10px;
      z-index: 9999;
      display: flex; gap: 8px;
    }
  </style>
</head>

<body>
  <div id="controls">
    <button id="saveBtn">ðŸ’¾ Save Camera</button>
    <button id="loadBtn">ðŸ“‚ Load Camera</button>
  </div>

  <script type="module">
    import { createStage, Female } from "mannequin";
    import * as mannequin from "mannequin";

    // 1ï¸âƒ£  Create the stage with a live animation loop
    const stage = createStage(() => {
      mannequin.stage.controls.update();
      mannequin.stage.renderer.render(mannequin.stage.scene, mannequin.camera);
    });

    // 2ï¸âƒ£  Add Abigail
    const abigail = new Female(1.6);
    abigail.stepOnGround();

    // 3ï¸âƒ£  Once the camera exists, position it
    const wait = setInterval(() => {
      if (mannequin.camera) {
        clearInterval(wait);
        mannequin.camera.position.set(0, 1.6, 3);
        mannequin.camera.lookAt(0, 1.0, 0);
      }
    }, 100);

    // 4ï¸âƒ£  Button handlers
    document.getElementById("saveBtn").addEventListener("click", () => {
      const cam = mannequin.camera;
      if (!cam) { alert("Camera not ready"); return; }

      const data = {
        position: cam.position.toArray(),
        rotation: { x: cam.rotation.x, y: cam.rotation.y, z: cam.rotation.z },
        fov: cam.fov
      };
      const text = JSON.stringify(data, null, 2);
      prompt("Copy this camera preset JSON:", text);
    });

    document.getElementById("loadBtn").addEventListener("click", () => {
      const json = prompt("Paste saved camera JSON:");
      if (!json) return;
      try {
        const data = JSON.parse(json);
        const cam = mannequin.camera;
        cam.position.fromArray(data.position);
        cam.rotation.set(data.rotation.x, data.rotation.y, data.rotation.z);
        cam.fov = data.fov;
        cam.updateProjectionMatrix();
      } catch (e) {
        alert("Invalid camera data");
      }
    });
  </script>
</body>
</html>
