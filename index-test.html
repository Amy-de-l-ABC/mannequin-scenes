<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Abigail Scene â€“ Save/Load Camera</title>
  <link rel="stylesheet" href="style.css">
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.167.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.167.0/examples/jsm/",
      "mannequin": "https://cdn.jsdelivr.net/npm/mannequin-js@latest/src/mannequin.js"
    }
  }
  </script>
</head>

<body>
  <div id="controls">
    <button id="saveBtn">ðŸ’¾ Save Camera</button>
    <button id="loadBtn">ðŸ“‚ Load Camera</button>
  </div>

  <script type="module">
    import { createStage, Female } from "mannequin";
    import * as mannequin from "mannequin";

    // --- helper: wait until mannequin.camera exists ---
    function getCamera() {
      return new Promise(resolve => {
        const check = setInterval(() => {
          if (mannequin.camera) {
            clearInterval(check);
            resolve(mannequin.camera);
          }
        }, 100);
      });
    }

    // --- main setup ---
    async function setup() {
      createStage(); // auto stage
      const camera = await getCamera(); // waits until camera ready
      console.log("Camera ready âœ…", camera);

      const abigail = new Female(1.6);
      abigail.stepOnGround();

      // --- button actions ---
      document.getElementById("saveBtn").addEventListener("click", () => {
        const data = {
          position: camera.position.toArray(),
          rotation: { x: camera.rotation.x, y: camera.rotation.y, z: camera.rotation.z },
          fov: camera.fov
        };
        const text = JSON.stringify(data, null, 2);
        prompt("Copy this camera preset JSON:", text);
      });

      document.getElementById("loadBtn").addEventListener("click", () => {
        const json = prompt("Paste previously saved camera JSON:");
        if (!json) return;
        try {
          const data = JSON.parse(json);
          camera.position.fromArray(data.position);
          camera.rotation.set(data.rotation.x, data.rotation.y, data.rotation.z);
          camera.fov = data.fov;
          camera.updateProjectionMatrix();
        } catch (err) {
          alert("Invalid camera data!");
        }
      });
    }

    setup(); // run everything
  </script>
</body>
</html>
